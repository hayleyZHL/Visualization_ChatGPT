<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Parallax Scrolling Effect</title>
</head>

<style>
    body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
    }
    .parallax-container {
        position: relative;
        height: 100%;
        overflow-y: scroll;
        overflow-x: hidden;
        perspective: 1px;
        perspective-origin: left;
    }
    .parallax-section {
        position: relative;
        height: 100%;
        display: flex;
        justify-content: space-around;
        align-items: center;
        background-color: #f0f0f0;
        background-position: center;
        background-size: cover;
    }
    #section0 { background-image: url('turing4.jpg'); }  /*background-image: url('https://static01.nyt.com/images/2018/05/10/briefing/cn-turing/cn-turing-jumbo.jpg');*/
    #section01 { background-image: url("https://automationswitch.com/wp-content/uploads/2021/01/automation-switch-geoff-hint-3-1024x499.png"); }
    #section2 { background-color: #e0e0e0; }
    .text-container {
        max-width: 60%;
        padding: 30px;
        box-sizing: border-box;
        font-size: 18px;
        background-color: rgba(255, 255, 255, 0.6); /* semi-transparent white background */
        border-radius: 5px; /* rounded corners */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); /* subtle shadow for depth */
    }
    /*.chart-container { max-width: 40%; }*/
    .chart-container {
        max-width: 40%;
        /*opacity: 0;*/
        /*transition: opacity 1s;*/
    }
    .chart {
        display: block;
        margin: 0 auto;
    }
    .gif-container {
        max-width: 40%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .gif {
        max-width: 100%;
        max-height: 100%;
        visibility: hidden;
        opacity: 0;
        transition: opacity 1s;
    }
    .tooltip {
        position: absolute;
        background-color: white;
        border: 2px solid black;
        padding: 8px;
        font-family: sans-serif;
        font-size: 20px;
    }
    .data-info {
        font-weight: bold;
        font-size: 24px;
        margin-top: 10px;
    }

</style>

<body>
<div class="parallax-container">
    <!-- section 0, Turing Image -->
    <div class="parallax-section" id="section0">
        <div class="text-container">
            <h2>Alan Turing</h2>
            <p>Imitation Game * The Father of AI * Imitation Game * The Father of AI * Imitation</p>
            <p>Imitation Game * The Father of AI * Imitation Game * The Father of AI * Imitation</p>
            <p>Imitation Game * The Father of AI * Imitation Game * The Father of AI * Imitation</p>
            <p>Imitation Game * The Father of AI * Imitation Game * The Father of AI * Imitation</p>
        </div>
        <div class="chart-container" style="visibility: hidden;">
            <svg class="chart" height="200" width="900"></svg> <!-- Invisible placeholder -->
        </div>
    </div>
    <!-- section 01, Hinton Image -->
    <div class="parallax-section" id="section01">
        <div class="chart-container" style="visibility: hidden;">
            <svg class="chart" height="200" width="900"></svg> <!-- Invisible placeholder -->
        </div>
        <div class="text-container">
            <h2>Geoffrey Hinton</h2>
            <p> Deep Learning * The Godfather of AI * Neural Networks</p>
            <p> Deep Learning * The Godfather of AI * Neural Networks</p>
            <p> Deep Learning * The Godfather of AI * Neural Networks</p>
            <p> Deep Learning * The Godfather of AI * Neural Networks</p>
        </div>
    </div>
    <!-- section 1, GIF -->
    <div class="parallax-section" id="section1">
        <div class="text-container">
            <h2>GIF Animation</h2>
            <p>Description for the GIF animation</p>
        </div>
        <div class="gif-container">
            <img alt="GIF description" class="gif" src="https://media.giphy.com/media/d1CuPQxMhtItfegHkk/giphy.gif"/>
        </div>
    </div>
    <!-- section 2, line chart -->
    <div class="parallax-section" id="section2">
        <div class="text-container">
            <div class="data-info">Data point: </div>
            <h2>Line Chart with D3</h2>
            <p>Description for the line chart</p>
        </div>
        <div class="chart-container"> <svg class="chart" height="200" width="400"></svg> </div>
    </div>
    <!-- section 3, bar chart -->
    <div class="parallax-section" id="section3">
        <div class="text-container">
            <h2>Bar Chart with D3</h2>
            <p>Description for the bar chart</p>
        </div>
        <div class="chart-container"> <svg class="chart" height="200" width="400"></svg> </div>
    </div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/scrollama"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Scrollama
        const scroller = scrollama();
        const parallaxContainer = document.querySelector('.parallax-container');
        function parallaxScroll() {
            const scrollTop = parallaxContainer.scrollTop;
            const windowHeight = window.innerHeight;
            document.querySelectorAll('.parallax-section').forEach((section, index) => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;
                if (scrollTop + windowHeight >= sectionTop && scrollTop <= sectionTop + sectionHeight) {
                    const translateAmount = (scrollTop - sectionTop) / 2;
                    const container = section.querySelector('.chart-container') || section.querySelector('.gif-container');
                    container.style.transform = `translateY(${translateAmount}px)`;
                }
            });
        }
        // Line Chart
        const lineChartData = [
            {x: 0, y: 180},
            {x: 1, y: 140},
            {x: 2, y: 80},
            {x: 3, y: 100},
            {x: 4, y: 110}
        ];
        const xScaleLine = d3.scaleLinear().domain(d3.extent(lineChartData, d => d.x)).range([0, 400]);
        const yScaleLine = d3.scaleLinear().domain(d3.extent(lineChartData, d => d.y)).range([180, 0]);
        const line = d3.line()
            .x(d => xScaleLine(d.x))
            .y(d => yScaleLine(d.y))
            .curve(d3.curveMonotoneX);
        const lineChartSvg = d3.select('#section2 .chart')
            .selectAll('path')
            .data([lineChartData])
            .join('path')
            .attr('d', line)
            .attr('stroke', 'steelblue')
            .attr('stroke-width', 2)
            .attr('fill', 'none');
        const pathLength = lineChartSvg.node().getTotalLength();
        lineChartSvg.attr('stroke-dasharray', `${pathLength} ${pathLength}`)
            .attr('stroke-dashoffset', pathLength);
        // Line Chart Circles
        const lineChartCircles = d3.select('#section2 .chart')
            .selectAll('circle')
            .data(lineChartData)
            .join('circle')
            .attr('cx', d => xScaleLine(d.x))
            .attr('cy', d => yScaleLine(d.y))
            .attr('r', 6)
            .style('stroke-width', 2)
            .style('stroke', 'white')
            .style('fill', 'steelblue')
            .on('mouseover', (event, d) => {
                const tooltip = d3.select('body')
                    .append('div')
                    .attr('class', 'tooltip')
                    .text(`${d.y}`);
                tooltip.style('left', `${event.pageX}px`)
                    .style('top', `${event.pageY}px`);
            })
            .on('mouseout', () => {
                setTimeout(() => { d3.select('.tooltip').remove();}, 100);
                // d3.select('.tooltip').remove();
            });
        // Bar Chart
        const barChartData = [
            {index: 0, value: 50},
            {index: 1, value: 70},
            {index: 2, value: 100},
            {index: 3, value: 90},
            {index: 4, value: 80}
        ];
        const xScaleBar = d3.scaleBand().domain(barChartData.map(d => d.index)).range([0, 400]).padding(0.2);
        const yScaleBar = d3.scaleLinear().domain([0, d3.max(barChartData, d => d.value)]).range([180, 0]);
        const barChartSvg = d3.select('#section3 .chart')
            .selectAll('rect')
            .data(barChartData)
            .join('rect')
            .attr('x', (d, i) => xScaleBar(i))
            .attr('width', xScaleBar.bandwidth())
            .attr('fill', 'steelblue')
            .attr('y', 180)
            .attr('height', 0);
// Scrollama configuration
        scroller
            .setup({
                step: '.parallax-section',
                offset: 0.5,
                progress: true
            })
            .onStepEnter(({element, index, direction}) => {
                // Load and display the GIF when section1 is visible
                if (index === 2) {
                    const gif = element.querySelector('.gif');
                    gif.style.visibility = 'visible';
                    gif.style.opacity = 1;
                }
                // if (index === 3 || index === 4) {
                //     const chartContainer = element.querySelector('.chart-container');
                //     chartContainer.style.opacity = 1;
                // }
            })
            .onStepProgress(({element, index, progress}) => {
                // Line Chart
                if (index === 3) {
                    lineChartSvg.attr('stroke-dashoffset', pathLength * (1 - progress * 2));
                    // Update data-info text based on animation progress
                    const dataIndex = Math.floor(progress * 2 * (lineChartData.length - 1));
                    const dataValue = lineChartData[dataIndex].y;
                    element.querySelector('.data-info').textContent = `Data point: ${dataValue}`;
                }
                // Bar Chart
                if (index === 4) {
                    barChartSvg.each(function (d) {
                        const bar = d3.select(this);
                        const targetHeight = yScaleBar(0) - yScaleBar(d.value);
                        bar.attr('height', targetHeight * progress * 2)
                            .attr('y', 180 - targetHeight * progress * 2);
                    });
                }
            })
            .onStepExit(({element, index}) => {
                // Hide the GIF when section1 is no longer visible
                if (index === 2) {
                    const gif = element.querySelector('.gif');
                    gif.style.opacity = 0;
                }
            });
        parallaxContainer.addEventListener('scroll', parallaxScroll);
        parallaxScroll(); // Initial Set Up
    });
</script>
</body>
</html>