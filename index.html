<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title> A Comprehensive Introduction to ChatGPT </title>
    <link href="styles.css" rel="stylesheet">
</head>

<body>
<!-- section 0, Intro Page -->
<div class="parallax-container">
    <div class="parallax-section" id="sectionIntro">
        <div class="text-container" id="introText">
            <h2> An introduction to </h2><h2><span class="title-highlight">ChatGPT</span></h2>
            <p> <span class="text-highlight">Keep Scrolling</span> and see how this revolutionary AI language model is changing the game!</p>
            <p>
                <img src="https://upload.wikimedia.org/wikipedia/commons/f/fd/Arrows_down_animated.gif" alt="Scroll down arrow" width="40" height="40">
            </p>
        </div>
        <div class="chart-container" style="visibility: hidden;">
            <svg class="chart" height="200" width="850"></svg> <!-- Invisible placeholder -->
        </div>
    </div>
    <!-- section 1, Turing & Turing Test -->
    <div class="parallax-section" id="section1">
        <div class="chart-container" style="visibility: hidden;">
            <svg class="chart" height="200" width="850"></svg> <!-- Invisible placeholder -->
        </div>
        <div class="text-container">
            <h2>The origin of AI</h2>
                <h2><span class="title-highlight"> Alan Turing </span></h2>
            <p>
                A renowned mathematician and computer scientist, notable for WWII codebreaking and AI pioneering.</p>
            <p>
                He introduced the <span class="text-highlight">Turing Test</span>, gauging a machine's ability to mimic human-like intelligence—if it deceives the evaluator into thinking it's human, it passes the test.</p>

<!--            <p>-->
<!--                <img src="https://media.geeksforgeeks.org/wp-content/uploads/Turing-Diagram-159676.png" width="300" height="170">-->

<!--            </p>-->

        </div>

    </div>

    <!-- section 2, Hinton & Neuron Network -->
    <div class="parallax-section" id="section2">

        <div class="text-container">
            <h2>The moderization of AI</h2> <h2><span class="title-highlight">Geoffrey Hinton</span></h2>
            <p> Geoffrey Hinton is a computer scientist and cognitive psychologist who revolutionized the field of artificial intelligence with his groundbreaking work on  <span class="text-highlight">neural networks</span>. </p>
            <p>
            His  work has enabled significant advances in artificial intelligence and machine learning,
                including the development of the transformer architecture used in the ChatGPT model. </p>
<!--            <p>-->
<!--                <img src="https://media.wired.com/photos/59327770edfced5820d10bb3/master/w_2560%2Cc_limit/ai_new-ft.jpg">-->


<!--            </p>-->
        </div>
        <div class="chart-container" style="visibility: hidden;">
            <svg class="chart" height="200" width="700"></svg> <!-- Invisible placeholder -->
        </div>
    </div>

    <!-- section 3, What is ChatGPT? -->
    <div class="parallax-section" id="section3">
        <div class="text-container">
            <h2>What is <span class="title-highlight">ChatGPT?</span></h2>
            <p>ChatGPT is a chatbot (or, in technical terms, a ‘large language model’) created by US-based artificial intelligence company OpenAI.</p>
            <p> When you ask ChatGPT a question, it draws on a huge body of textual data — large chunks of content found on the Internet,
                many books, all of Wikipedia — to provide you with a human-like answer to it. </p>
            <p>You can also ask ChatGPT to create content for you — it can write poems, create computer code, translate languages,
                provide article structures and do much else besides.</p>
        </div>
        <p>
            <img src="https://static.wixstatic.com/media/a89add_3d73f7e43cff4f37bdf0af4772ef6595~mv2.gif" width="200" height="200" style="float: outside">
        </p>
        <div class="quiz-container" id="ready">
            <div class="question">
                Are you ready to take a quiz?
            </div>
            <div class="options">
                <div class="start-btn" onclick="showQuiz()">Start Quiz</div>
            </div>
        </div>
        <div class="quiz-container" id="quiz" style="display: none;">
            <div class="question">
                Now, do you think ChatGPT passed the Turing Test?
            </div>
            <div class="options">
                <div class="option" onclick="showFeedback('yes')">Yes</div>
                <div class="option" onclick="showFeedback('no')">No</div>
            </div>
            <div class="feedback" id="feedback-yes">
                According to Buzzfeed data scientist Max Woolf, ChatGPT has passed the Turing Test by producing responses
                that were indistinguishable from human conversation to a panel of judges.
            </div>
            <div class="feedback" id="feedback-no">
                If you ask ChatGPT if it is capable of passing the Turing test, the answer from the chatbot is a definitive ‘No!’
            </div>
            <p>
            <img class="reveal-image" id="reveal-image" src="https://pbs.twimg.com/media/Fr47uLLX0AENP8i.jpg:large" alt="Image after quiz completion" width="500" height="250" style="margin-top: 20px;">
            </p>
        </div>
    </div>
    <!-- section 4, How many people use ChatGPT? -->
    <div class="parallax-section" id="section4">
        <div class="text-container">
            <h2>How many people use ChatGPT?</h2>
            <h2><span class="title-highlight">User Growth</span></h2>
            <div class="data-info"></div>
            <p>ChatGPT crossed 1 million users in 5 days of launch and set the record for the fastest-growing platform by gaining 100 million users by January. It reached 1 billion visits in February and 1v.6 billion visits in March 2023.
            </p>
            <p>Also, it reached 1 billion visits in February and 1.6 billion visits in March 2023.</p>
        </div>
        <div class="chart-container"> <svg class="chart" height="400" width="700"></svg> </div>
    </div>
    <!-- section 5, How long did it take for other platforms to reach a certain number of users? -->
    <div class="parallax-section" id="section5">
        <div class="chart-container">
            <svg class="chart" height="370" width="650"></svg>
        </div>
        <div class="text-container">
            <h2>Time for platforms to reach </h2> <h2> <span class="title-highlight">1 million users</span></h2>
            <p><span class="text-highlight">ChatGPT obtained 1 million users within 5 days of its initial launch in November 2022. </span></p>
                <p>To put its phenomenal user acquisition rate into perspective,
                the app that came closest to acquiring one million users this quickly is Instagram, which gained 1 million users after around two and a half months after launch — 70 days, or 1500% more slowly than ChatGPT.
                </p>
            <p>
            Spotify and Meta also achieved the feat quickly - in 5 and 10 months, respectively, being services that like ChatGPT offer an immediate practical use.
                Apart from Instagram, social media services usually took a bit longer to gain one million users.
            </p>
        </div>

    </div>
    <!-- section 6, What was the size of the dataset used for training ChatGPT? -->
    <div class="parallax-section" id="section6">
        <div class="text-container">
            <h2>Trillions of parameters!</h2><h2> <span class="title-highlight">Training data</span></h2>
            <p>The dataset for training ChatGPT-4 — the latest version of ChatGPT — is estimated to consist of 100 trillion parameters, more than 5 times larger than the training data for ChatGPT-3. </p>
            <p>Chat-GPT-4 training data included feedback from users of ChatGPT-3 as well as feedback from over 50 AI safety and security experts.</p>
        </div>
        <div class="chart-container"> <svg class="chart" height="400" width="800"></svg> </div>
    </div>
    <!-- section 7,  How big is the artificial intelligence market? -->
    <div class="parallax-section" id="section7">
        <div class="text-container" style="position: absolute; top: 50px;">
            <h2>How big is the <span class = "title-highlight">AI market?</span></h2>
<!--            <p>The overall value of the AI market is projected to hit $150+ billion dollars in 2023, rising to as much as $1.5 trillion by 2030</p>-->
<!--            <p>  In 2021, global corporate investment in AI was almost $94 billion worldwide. </p>-->
        </div>
        <span id="keepscroll" style="position: absolute; top: 220px; opacity: 0">keep scrolling...</span>
        <div class="options" id="sendimentationButtons" style="position: absolute; top: 220px; opacity: 0">
            <div class="option" id="startButton">REVEAL</div>
            <div class="option" id="resetButton">RESET</div>
        </div>
        <div class="chart-container"> <svg class="chart" style="position: absolute; left: 0px; bottom: 0px;">
        </svg>
        </div>
    </div>
    <!-- section 8, Will I lose my job because of ChatGPT? -->
    <div class="parallax-section" id="section8">
        <div class="text-container">
            <h2>Will ChatGPT </h2><h2><span class="title-highlight">take my job?</span></h2>
            <p>In 2013, a university of Oxford study estimated that 47% of the U&S workforce could potentially be replaced by AI over the next few decades. </p>
            <p>
            Sectors likely to be particularly affected by AI advancements include tech, media, law, market research and finance.
            </p>
            <p>Examples of jobs likely to be affected significantly by AI include programmers; journalists; paralegals, legal assistants; market researchers; educators; financial analysts; personal financial advisors; traders; graphic designers; accountants; and customer service agents.

            </p>
        </div>
        <div class="quiz-container" id="jobQuiz"></div>
        <div class="chart-container"> <svg class="chart" id="jobQuizStats" style="display: none;"></svg> </div>
    </div>
    <!-- section 9, Take a look at some of the interesting prompts!  -->
    <div class="parallax-section" id="section9">
        <div class="text-container">
            <h2>Take a look at some of the <span class="title-highlight">interesting prompts!</span></h2>
            <p>Description</p>
        </div>
        <div class="chart-container"> <svg class="chart" height="200" width="400"></svg> </div>
    </div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/scrollama"></script>

<script>


    const lineData = [  // in million
        {time: "November, 2022", users: 0},
        {time: "December, 2022", users: 1},  // 1 million in 5 days
        {time: "January, 2023", users: 100}  // 100 million
    ];
    const competitorData = [
        {company: "ChatGPT", duration: "5 days", launched: 2022},
        {company: "Instagram", duration: "2 months", launched: 2010},
        {company: "Spotify", duration: "5 months", launched: 2008},
        {company: "Meta", duration: "10 months", launched: 2004},
        {company: "Netflix", duration: "3.5 years", launched: 1999},
    ];
    const trainingSizeData = [  // in million
        {model: "ChatGPT 1", size: 10, description: "117 Million Parameters"},
        {model: "ChatGPT 2", size: 18, description: "1.5 Billion Parameters"},
        {model: "ChatGPT 3", size: 30, description: "175 Billion Parameters"},
        {model: "ChatGPT 4", size: 100, description: "100 Trillion Parameters"}
    ];
    // "title": "Global artificial intelligence market size 2021-2030",
    // "description": "Artificial intelligence (AI) market size worldwide in 2021 with a forecast until 2030 (in million U.S. dollars)",
    // source: https://www.statista.com/statistics/1365145/artificial-intelligence-market-size/#:~:text=The%20market%20for%20artificial%20intelligence,nearly%20two%20trillion%20U.S.%20dollars.
    const marketDataByYear = [
        {"year": 2021, "value": 95602.77},
        {"year": 2022, "value": 142319.80},
        {"year": 2023, "value": 207902.42},
        {"year": 2024, "value": 298246.87},
        {"year": 2025, "value": 420465.53},
        {"year": 2026, "value": 582948.69},
        {"year": 2027, "value": 795384.63},
        {"year": 2028, "value": 1068718.47},
        {"year": 2029, "value": 1415054.84},
        {"year": 2030, "value": 1847495.60}
    ];
    const dataAIMarket = [
        { category: "Healthcare", value: 0, maxValue: 188 },
        { category: "Agriculture", value: 0, maxValue: 7.3 },
        { category: "Finance", value: 0, maxValue: 41.6 },
        { category: "Marketing", value: 0, maxValue: 1591 },
        { category: "Automotive", value: 0, maxValue: 20 },
        { category: "Food", value: 0, maxValue: 15 },
        { category: "Manufacturing", value: 0, maxValue: 52.4 },
        { category: "Construction", value: 0, maxValue: 5 },
        { category: "HR", value: 0, maxValue: 56.2 },
        { category: "Retail", value: 0, maxValue: 57.8 },
        { category: "Education", value: 0, maxValue: 23.92 },
        { category: "Transportation", value: 0, maxValue: 14.79 }
    ];

    const jobData = [ // mock data
        {
            "Industry": "Technology",
            "Jobs_At_Risk_Percentage": 60,
            "Concern_Level_Extremely": 45,
            "Concern_Level_Moderately": 30,
            "Concern_Level_Slightly": 20,
            "Concern_Level_Not_At_All": 5
        },
        {
            "Industry": "Media",
            "Jobs_At_Risk_Percentage": 50,
            "Concern_Level_Extremely": 40,
            "Concern_Level_Moderately": 30,
            "Concern_Level_Slightly": 25,
            "Concern_Level_Not_At_All": 5
        },
        {
            "Industry": "Law",
            "Jobs_At_Risk_Percentage": 40,
            "Concern_Level_Extremely": 35,
            "Concern_Level_Moderately": 30,
            "Concern_Level_Slightly": 25,
            "Concern_Level_Not_At_All": 10
        },
        {
            "Industry": "Market Research",
            "Jobs_At_Risk_Percentage": 45,
            "Concern_Level_Extremely": 35,
            "Concern_Level_Moderately": 30,
            "Concern_Level_Slightly": 25,
            "Concern_Level_Not_At_All": 10
        },
        {
            "Industry": "Finance",
            "Jobs_At_Risk_Percentage": 55,
            "Concern_Level_Extremely": 40,
            "Concern_Level_Moderately": 35,
            "Concern_Level_Slightly": 20,
            "Concern_Level_Not_At_All": 5
        }
    ]


    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Scrollama
        const scroller = scrollama();
        const parallaxContainer = document.querySelector('.parallax-container');
        function parallaxScroll() {
            const scrollTop = parallaxContainer.scrollTop;
            const scrollBottom = parallaxContainer.scrollTop +  parallaxContainer.scrollHeight;
            const windowHeight = window.innerHeight;
            document.querySelectorAll('.parallax-section').forEach((section, index) => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;
                const sectionBottom = section.offsetTop + sectionHeight;
                const container = section.querySelector('.chart-container') || section.querySelector('.quiz-container');
                const containerText = section.querySelector('.text-container');

                // console.log("sectionTop: " + sectionTop)
                // console.log("scrollTop: " + scrollTop)
                // console.log("chartOffsetHeight: " + chartOffsetHeight)
                if (section.id != "section7") {
                    // if (scrollTop + windowHeight >= sectionTop && scrollTop <= sectionTop + sectionHeight) {
                    // if (sectionTop <= scrollTop + chartOffsetHeight && scrollTop <= sectionTop + sectionHeight ) {
                    if (sectionTop <= scrollTop && scrollTop <= sectionTop + sectionHeight ) {

                    const translateAmount = (scrollTop - sectionTop) / 2;
                        const translateAmountText = -(scrollTop - sectionTop) / 3;
                        container.style.transform = `translateY(${translateAmount}px)`;
                        containerText.style.transform = `translateY(${translateAmountText}px)`;
                    }

                } else { // index == 7
                    // let containerHalfTopDist = containerText.offsetTop*0.5
                    const buttonContainer = section.querySelector('.options')
                    const keepscroll = section.querySelector('#keepscroll')
                    if (sectionTop <= scrollTop && scrollTop <= sectionBottom-800) {
                            const translateYAmount = scrollTop - sectionTop;
                            containerText.style.transform = `translateY(${translateYAmount}px)`;
                            buttonContainer.style.transform = `translateY(${translateYAmount}px)`;
                        keepscroll.style.transform = `translateY(${translateYAmount}px)`;
                    }
                }
            });
        }
        drawLineChart(lineData);
        drawBarChart(competitorData);
        drawCircles(trainingSizeData);
        drawSendimentationBars(dataAIMarket);
        showIndustryQuiz();
        // Scrollama configuration
        scroller
            .setup({
                step: '.parallax-section',
                offset: 0.5,
                progress: true
            })
            .onStepEnter(({element, index, direction}) => { handleStepEnter(element, index, direction); })
            .onStepProgress(({element, index, progress}) => { handleStepProgress(element, index, progress); })
            .onStepExit(({element, index}) => { handleStepExit(element, index); });

        parallaxContainer.addEventListener('scroll', () => {
            parallaxScroll();
        });
        parallaxScroll(); // Initial Set Up

        function handleStepEnter(element, index, direction) {
            if (index === 3) {
                const quiz = element.querySelector('.quiz-container');
            }
            if (index === 7) {
                parallaxContainer.addEventListener('scroll', changeSection7BackgroundColor);
            }
        }
        function handleStepProgress(element, index, progress) {
            // Line Chart
            if (index === 4) {
                let lineSvg = d3.select('#section4 .chart').selectAll('path')
                const pathLength = lineSvg.node().getTotalLength();
                lineSvg.attr('stroke-dashoffset', pathLength * (1 - progress * 2 * 1.1));
                // Update data-info text based on animation progress
                const dataIndex = Math.floor(progress * 2 * (lineData.length - 1));
                const dataValue = lineData[dataIndex].users;
                const dataTime = lineData[dataIndex].time;
                if (dataValue === 0){
                    element.querySelector('.data-info').textContent = `ChatGPT was launched on ${dataTime}, by San Francisco–based OpenAI.`;
                } else if (dataValue === 1){
                    element.querySelector('.data-info').textContent = ` By ${dataTime}, ChatGPT had over ${dataValue} million users.`;
                } else {
                    element.querySelector('.data-info').textContent = ` In ${dataTime}, ChatGPT reached over ${dataValue} million users, making it the fastest growing consumer application to date.`;
                }

            }
            // Bar Chart
            if (index === 5) {
                const margin = { top: 50, right: 20, bottom: 50, left: 80 };
                const height = 370 - margin.top - margin.bottom;
                let barSvg = d3.select('#section5 .chart').selectAll('rect')
                const yScaleBar = d3.scaleLinear()
                    .domain([0, d3.max(competitorData, d => durationToDays(d.duration))])
                    .range([height, 0]);
                barSvg.each(function (d) {
                    const bar = d3.select(this);
                    const targetHeight = yScaleBar(0) - yScaleBar(durationToDays(d.duration));
                    bar.attr('height', targetHeight * progress * 2 * 1.1)
                        .attr('y', (height - targetHeight * progress * 2  * 1.1));
                });
            }
            // Circles
            if (index === 6) {
                let circlesSvg = d3.select('#section6 .chart').selectAll('circle');
                circlesSvg.each(function (d) {
                    const circle = d3.select(this);
                    const originalRadius = d.size;
                    const radiusScale = progress * 2 * 1.1;
                    const targetRadius = originalRadius * radiusScale;
                    circle.attr('r', targetRadius);
                });
            }
        }
        function handleStepExit(element, index) {
            // Hide the GIF when section3 is no longer visible
            if (index === 3) {
                // const quiz = element.querySelector('.quiz-container');
                // quiz.style.opacity = 0;
            }
            if (index === 7) {
                parallaxContainer.removeEventListener('scroll', changeSection7BackgroundColor);
            }
        }
    });

    function changeSection7BackgroundColor() {
        const section7 = document.getElementById('section7');
        let buttonsContainer = document.getElementById('sendimentationButtons');
        let keepscroll = document.getElementById('keepscroll');

        const parallaxContainer = document.querySelector('.parallax-container');
        const section7Top = section7.offsetTop;
        const scrollTop = parallaxContainer.scrollTop;
        const progress = Math.min(Math.max(0, scrollTop - section7Top) / section7.offsetHeight, 1);
        const currentColor = d3.color('#373542');
        const targetColor = d3.color('#464354');
        const interpolatedColor = d3.interpolateRgb(currentColor, targetColor)(progress*2);
        section7.style.backgroundColor = interpolatedColor;
        if (progress < 0.4) {
            buttonsContainer.style.opacity = 0;
            keepscroll.style.opacity = progress*6;
        } else {
            keepscroll.style.opacity = 0;
            buttonsContainer.style.opacity = progress*8-3;
            console.log(progress)
            console.log(buttonsContainer.style.opacity)
        }
    }

    // Draw Charts
    function drawLineChart(lineChartData) {
        const parseDate = d3.timeParse("%B, %Y");
        const margin = { top: 50, right: 20, bottom: 50, left: 50 };
        const width = 700 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;

        const xScaleLine = d3.scaleTime()
            .domain(d3.extent(lineChartData, d => parseDate(d.time)))
            .range([0, width]);
        const yScaleLine = d3.scaleLinear()
            .domain(d3.extent(lineChartData, d => d.users))
            .range([height, 0]);

        const xAxis = d3.axisBottom(xScaleLine);
        const yAxis = d3.axisLeft(yScaleLine).ticks(5);

        const grid = d3.axisLeft(yScaleLine)
            .tickFormat('')
            .tickSize(-width)
            .ticks(5);

        const line = d3.line()
            .x(d => xScaleLine(parseDate(d.time)))
            .y(d => yScaleLine(d.users))
            .curve(d3.curveMonotoneX);

        const chartSvg = d3.select('#section4 .chart')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
            .append('g')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);

        chartSvg.append('g')
            .attr('class', 'x axis')
            .attr('transform', `translate(0, ${height})`)
            .call(xAxis);

        chartSvg.append('g')
            .attr('class', 'y axis')
            .call(yAxis);

        chartSvg.append('g')
            .attr('class', 'grid')
            .call(grid);

        const lineChartSvg = chartSvg.append('path')
            .data([lineChartData])
            .attr('d', line)
            .attr('stroke', "#4ca184")
            .attr('stroke-width', 2.5)
            .attr('fill', 'none');

        const pathLength = lineChartSvg.node().getTotalLength();
        lineChartSvg.attr('stroke-dasharray', `${pathLength} ${pathLength}`)
            .attr('stroke-dashoffset', pathLength);

        chartSvg.selectAll('circle')
            .data(lineChartData)
            .enter()
            .append('circle')
            .attr('cx', d => xScaleLine(parseDate(d.time)))
            .attr('cy', d => yScaleLine(d.users))
            .attr('r', 7)
            .style('stroke-width', 3)
            .style('stroke', 'white')
            .style('fill', "#4ca184")
            .on('mouseover', (event, d) => {
                const tooltip = d3.select('body')
                    .append('div')
                    .attr('class', 'tooltip')
                    .text(`${d.users} million`);
                tooltip.style('left', `${event.pageX}px`)
                    .style('top', `${event.pageY}px`);
            })
            .on('mouseout', () => {
                d3.select('.tooltip').remove();
            });

        // Add chart title
        chartSvg.append('text')
            .attr('class', 'chart-title')
            .attr('x', width / 2)
            .attr('y', -30)
            .attr('text-anchor', 'middle')
            .style('font-size', '24px')
            .style('font-weight', 'bold')
            .text('ChatGPT User Growth');

        // Add x-axis title
        chartSvg.append('text')
            .attr('class', 'x-axis-title')
            .attr('x', width / 2)
            .attr('y', height + margin.bottom )
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .text('Time');

        // Add y-axis title
        chartSvg.append('text')
            .attr('class', 'y-axis-title')
            .attr('x', -height / 2)
            .attr('y', -margin.left + 10)
            .attr('transform', 'rotate(-90)')
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .text('#Users (Million)');
    }

    function drawBarChart(competitorData) {
        const margin = { top: 50, right: 20, bottom: 50, left: 80 };
        const width = 650 - margin.left - margin.right;
        const height = 370 - margin.top - margin.bottom;

        const xScaleBar = d3.scaleBand().domain(competitorData.map(d => d.company)).range([0, width]).padding(0.2);
        const yScaleBar = d3.scaleLinear()
            .domain([0, d3.max(competitorData, d => durationToDays(d.duration))])
            .range([height, 0]);

        const yAxisTicks = d3.axisLeft(yScaleBar)
            .ticks(5) // Add this line to specify the number of ticks
            .tickFormat(d => {
                if (d % 365 === 0) return `${d / 365} years`;
                if (d % 30 === 0) return `${d / 30} months`;
                return `${d} days`;
            });
        const chart = d3.select('#section5 .chart')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
            .append('g')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);

        // Add title and axis titles
        chart.append('text')
            .attr('class', 'chart-title')
            .attr('x', width / 2)
            .attr('y', -20)
            .style('text-anchor', 'middle')
            .style('font-size', '18px')
            .text('Time to Reach 1 Million Users');

        chart.append('text')
            .attr('class', 'axis-title')
            .attr('x', -height / 2)
            .attr('y', -67)
            .attr('transform', 'rotate(-90)')
            .style('text-anchor', 'middle')
            .style('font-size', '12px')
            .text('Duration');

        chart.append('text')
            .attr('class', 'axis-title')
            .attr('x', width / 2)
            .attr('y', height + 40)
            .style('text-anchor', 'middle')
            .style('font-size', '12px')
            .text('Platform');

        const tooltip = chart
            .append('g')
            .style('opacity', 0)
            .style('font-size', '12px')
            .style('text-anchor', 'middle');

        tooltip
            .append('text')
            .attr('class', 'tooltip-text tooltip-duration')
            .attr('y', -25);

        tooltip
            .append('text')
            .attr('class', 'tooltip-text tooltip-launched')
            .attr('y', -10);

        chart.selectAll('rect')
            .data(competitorData)
            .join('rect')
            .attr('x', (d, i) => xScaleBar(d.company))
            .attr('width', xScaleBar.bandwidth())
            // .attr('fill', (d, i) => colorScale(i))
            .attr('fill', "#4ca184")
                .attr('y', d => yScaleBar(durationToDays(d.duration)))
            // .attr('height', d => (height - yScaleBar(durationToDays(d.duration))))
            .attr('height', 0)
                .on('mouseover', (event, d) => {
                d3.select(event.currentTarget)
                    .attr('fill', "#a8d5c7")
                    .attr('width', xScaleBar.bandwidth() * 1.05)
                    tooltip
                    .style('opacity', 1)
                    .attr('transform', `translate(${xScaleBar(d.company) + xScaleBar.bandwidth() / 2}, ${yScaleBar(durationToDays(d.duration))})`);
                tooltip.select('.tooltip-launched')
                    .text(`Launched in ${d.launched}`);
                tooltip.select('.tooltip-duration')
                    .text(`Took ${d.duration}`);
            })
            .on('mouseout', function(event, d) {
                d3.select(event.currentTarget)
                .attr('fill', "#4ca184")
            .attr('width', xScaleBar.bandwidth())

                // .attr('fill', colorScale(competitorData.indexOf(d)));
                tooltip.style('opacity', 0);
            });

        chart.append('g')
            .attr('transform', `translate(0, ${height})`)
            .call(d3.axisBottom(xScaleBar));

        chart.append('g')
            .call(yAxisTicks);

    }

    function drawCircles(trainingSizeData) {
        const margin = { top: 30, right: 20, bottom: 30, left: 50 };
        const width = 800 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;

        const chartSvg = d3.select('#section6 .chart')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
            .append('g')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);

        const circles = chartSvg.selectAll('circle')
            .data(trainingSizeData)
            .enter()
            .append('circle')
            .attr('cx', (d, i) => width / trainingSizeData.length * (i + 0.5))
                .attr('cy', height / 2)
            .attr('r', 0)
            .attr('fill', "#4ca184");

        const textLabels = chartSvg.selectAll('text')
            .data(trainingSizeData)
            .join('text')
            .attr('x', (d, i) => width / trainingSizeData.length * (i + 0.5))
            .attr('y', (d, i) => {
                const circleCenterY = height / 2;
                const textSize = 14; // font-size from .attr('font-size', '14px')
                if (d.size > 50) {
                    return circleCenterY; // Inside the circle
                } else {
                    return circleCenterY + d.size + textSize / 2 + 10; // Below the circle (with a small margin)
                }
            })
            .text(d => d.model)
            .attr('text-anchor', 'middle')
            .attr('dominant-baseline', 'middle')
            .attr('fill', 'black')
            .attr('font-size', '14px');

        // Add the filter
        const defs = chartSvg.append('defs');
        const filter = defs.append('filter')
            .attr('id', 'shadow')
            .attr('x', '-50%')
            .attr('y', '-50%')
            .attr('width', '200%')
            .attr('height', '200%');

        filter.append('feOffset')
            .attr('result', 'offOut')
            .attr('in', 'SourceAlpha')
            .attr('dx', 3)
            .attr('dy', 3);

        filter.append('feGaussianBlur')
            .attr('result', 'blurOut')
            .attr('in', 'offOut')
            .attr('stdDeviation', 5);

        filter.append('feBlend')
            .attr('in', 'SourceGraphic')
            .attr('in2', 'blurOut')
            .attr('mode', 'normal');

        // circles.style('filter', 'url(#shadow)');

        // Add hover behavior for showing description
        circles.on('mouseover', (event, d) => {
            d3.select(event.currentTarget)
                .attr('fill', "#a8d5c7")
            .style('filter', 'url(#shadow)');

            const tooltip = d3.select('body')
                .append('div')
                .attr('class', 'tooltip')
                .text(d.description);

            tooltip.style('left', `${event.pageX}px`)
                .style('top', `${event.pageY}px`);
        })
            .on('mouseout', (event) => {
                d3.select(event.currentTarget)
                    .attr('fill', "#4ca184")
                    .style('filter', null);
                d3.select('.tooltip').remove();
            });


    }

    function drawSendimentationBars(dataAIMarket) {

        const margin = { top: 60, right: 15, bottom: 0, left: 15 };
        const screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        const width = screenWidth - margin.left - margin.right;
        const height = 450 - margin.top - margin.bottom;

        const x = d3.scaleBand()
            .domain(dataAIMarket.map(d => d.category))
            .rangeRound([0, width])
            .padding(0.1);

        const maxValueExtent = d3.extent(dataAIMarket, d => d.maxValue);

        const logScale = d3.scaleLog()
            .domain(maxValueExtent)
            .range([0, height]);

        dataAIMarket.forEach(d => {
            d.scaledMaxValue = logScale(d.maxValue);
        });

        const y = d3.scaleLinear()
            .domain(d3.extent(dataAIMarket, d => d.scaledMaxValue))
            .range([0, height]);

        const numSegments = 120;
        const tokenSize = (height / numSegments) * 1.25;
        const durationTime = 25;

        dataAIMarket.forEach(d => {
            d.maxTokenNumValue = Math.floor(y(d.scaledMaxValue) / tokenSize);
        });

        const svg = d3.select('#section7 .chart')
            .attr("width", screenWidth)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`);

        // Gooey effect filter
        const defs = svg.append("defs");
        const filter = defs.append("filter")
            .attr("id", "gooey");

        filter.append("feGaussianBlur")
            .attr("in", "SourceGraphic")
            .attr("stdDeviation", "3.2")
            .attr("result", "blur");

        filter.append("feColorMatrix")
            .attr("in", "blur")
            .attr("type", "matrix")
            .attr("values", "1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7")
            .attr("result", "gooey");

        filter.append("feComposite")
            .attr("in", "SourceGraphic")
            .attr("in2", "gooey")
            .attr("operator", "atop");

        const customColorScheme = [
            '#719B95',
            '#83A79F',
            '#95B3A9',
            '#A7BFB3',
            '#B9CBCD',
            '#C8D0D2',
            '#D3C3B9',
            '#DEB6A0',
            '#E9A987',
            '#F49C6E',
            '#FF8F55',
            '#FF8250',
        ];
        const colorScale = d3.scaleOrdinal(customColorScheme);
        const categoryGroups = svg.selectAll(".category-group")
            .data(dataAIMarket)
            .enter().append("g")
            .attr("class", "category-group")
            .attr("filter", "url(#gooey)");  // Apply the filter to each group

        const topBars = categoryGroups.append("rect")
            .attr("class", "bar")
            .attr("x", d => x(d.category))
            .attr("y", -57)
            .attr("width", x.bandwidth())
            .attr("height", 24)
            .style("fill", (d, i) => colorScale(i))
            .attr("opacity", 0);

        const bars = categoryGroups.append("rect")
            .attr("class", "bar")
            .attr("x", d => x(d.category))
            .attr("y", height)
            .attr("width", x.bandwidth())
            .attr("height", 0)
        .style("fill", function (d, i) {
            let color = colorScale(i);
            d3.select(this).style("text-shadow", `0 0 8px rgba(${color.r}, ${color.g}, ${color.b}, 0.55)`);
            return color;
        })

        const categoryLabels = svg.selectAll(".category-label")
            .data(dataAIMarket)
            .enter().append("text")
            .attr("class", "category-label")
            .attr("x", d => x(d.category) + x.bandwidth() / 2)
            .attr("y", -40)
            .attr("text-anchor", "middle")
            .text(d => d.category)
            .style("fill", "black")
        // .style("fill", function (d, i) {
            //     let color = colorScale(i);
            //     d3.select(this).style("text-shadow", `0 0 8px rgba(${color.r}, ${color.g}, ${color.b}, 0.55)`);
            //     return color;
            // })
            .style("font-family", "Garamond")
            .attr("opacity", 0);


        const circleWrapper = categoryGroups.append("g");

        const tokens = [];

        function ticked() {
            circleWrapper.selectAll(".token")
                .attr("cx", d => d.x)
                .attr("cy", d => d.y)
        }
        const tokenMap = new Map();
        const simulationMap = new Map();

        dataAIMarket.forEach((d) => {
            tokenMap.set(d.category, []);
            const simulation = d3.forceSimulation(tokens)
                .force("x", d3.forceX((token) => token.targetX).strength(0.06))
                .force("y", d3.forceY((token) => token.targetY).strength(0.085))
                .force("collide", d3.forceCollide(tokenSize))
                .on("tick", () => {
                    limitBarWidth(d.category);
                    ticked();
                });
            simulationMap.set(d.category, simulation);
        });

        function limitBarWidth(category) {
            const tokens = tokenMap.get(category);

            for (const token of tokens) {
                const barX = x(token.category);
                const barWidth = x.bandwidth();
                const xMin = barX + token.radius;
                const xMax = barX + barWidth - token.radius;

                if (token.x < xMin) {
                    token.x = xMin;
                }
                if (token.x > xMax) {
                    token.x = xMax;
                }

                // Update token.targetY to keep it above the bar
                const barHeight = dataAIMarket.find(d => d.category === token.category).value * (tokenSize * 2);
                const barY = height - barHeight;
                const yMax = barY - token.radius*3;

                if (token.y > yMax) {
                    token.targetY = yMax;
                }
                // Prevent token from going below the bar top
                if (token.y >= barY) {
                    token.y = barY - token.radius*3;
                }

            }
        }

        function addToken(categoryIndex) {
            const category = dataAIMarket[categoryIndex].category;
            const tokens = tokenMap.get(category);
            const simulation = simulationMap.get(category);

            const barHeight = dataAIMarket[categoryIndex].value * tokenSize * 2;
            const barY = height - barHeight;

            const token = {
                category: category,
                value: dataAIMarket[categoryIndex].value,
                x: x(category) + x.bandwidth() / 2,
                // y: -tokenSize,
                y: -58,
                targetX: x(category) + Math.random() * x.bandwidth(),
                targetY: barY - tokenSize * 3,
                radius: tokenSize
            };

            tokens.push(token);

            // Check if the bar has more than 10 tokens, and if so, remove the oldest one
            if (tokens.length > 10) {
                tokens[0].disappearing = true;
                disappearToken(tokens[0]);
                tokens.shift(); // Remove the first token from the array
            }

            dataAIMarket[categoryIndex].value += 1;
            updateBars();

            const circles = circleWrapper.selectAll(`.token-${category}`)
                .data(tokens)
                .join("circle")
                .attr("class", `token token-${category}`)
                .attr("r", (d) => d.radius)
                .style("fill", colorScale(categoryIndex));

            simulation.nodes(tokens);
            simulation.alpha(1).restart();
        }


        function updateBars() {
            bars.data(dataAIMarket)
                .transition()
                .duration(durationTime)
                .attr("y", d => height - d.value * tokenSize * 2)
                .attr("height", d => d.value * tokenSize * 2)
        }

        function disappearToken(token) {
            if (!token.disappearing) return;
            token.radius = Math.max(0, token.radius - 0.1);
            circleWrapper.selectAll(".token")
                .data(tokens)
                .attr("r", d => d.radius);
            if (token.radius <= 0) {
                tokens.splice(tokens.indexOf(token), 1);
            } else {
                requestAnimationFrame(() => {
                    disappearToken(token);
                });
            }
        }

        function barReachedTop(index) {
            return dataAIMarket[index].value >= dataAIMarket[index].maxTokenNumValue/2;
        }

        const availableCategories = dataAIMarket.map((_, index) => index);
        let intervalId;

        function startAnimation() {
            topBars.attr("opacity", 0.6);
            categoryLabels.transition().duration(800).attr("opacity", 0.8);

            intervalId = setInterval(() => {
                if (availableCategories.length === 0) {
                    clearInterval(intervalId); // Stop the interval when all bars reached the top
                    circleWrapper.selectAll(".token")
                        .transition()
                        .duration(9000)
                        .attr("r", 1);
                    bars.data(dataAIMarket)
                        .transition()
                        .duration(4200)
                        .attr("y", d => height - (d.value + 1.3 ) * tokenSize * 2)
                        .attr("height", d => (d.value + 1.3 ) * tokenSize * 2)
                } else {
                    const randomIndex = Math.floor(Math.random() * availableCategories.length);
                    const categoryIndex = availableCategories[randomIndex];
                    addToken(categoryIndex);
                    if (barReachedTop(categoryIndex)) {

                        availableCategories.splice(randomIndex, 1);
                    }
                }
            }, durationTime);
        }

        function resetAnimation() {
            topBars.attr("opacity", 0);
            categoryLabels.attr("opacity", 0);
            clearInterval(intervalId);
            availableCategories.length = 0;
            dataAIMarket.forEach((d, index) => {
                d.value = 0;
                availableCategories.push(index);
                const tokens = tokenMap.get(d.category);
                tokens.length = 0;
                tokenMap.set(d.category, tokens);
            });
            updateBars();
            circleWrapper.selectAll(".token").remove();
        }

        document.getElementById("startButton").addEventListener("click", startAnimation);
        document.getElementById("resetButton").addEventListener("click", resetAnimation);
    }

    // Helper Functions
    function convertSizeToBillion(size) {
        if (size.includes('Million')) {
            return parseFloat(size) / 1000;
        } else if (size.includes('Trillion')) {
            return parseFloat(size) * 1000;
        }
        return parseFloat(size);
    }

    function durationToDays(duration) {
        if (duration.includes("days")) {
            if (duration == "5 days") {
                return parseFloat(duration)*5;
            }
            return parseFloat(duration);
        } else if (duration.includes("months")) {
            return parseFloat(duration) * 30;
        } else if (duration.includes("years")) {
            return parseFloat(duration) * 365;
        }
        return 0;
    }

    function showQuiz() {
        document.getElementById("ready").style.display = "none";
        document.getElementById("quiz").style.display = "block";
    }

    function showFeedback(option) {
        document.getElementById("feedback-" + option).style.display = "block";
        document.getElementById("reveal-image").style.display = "block";
        document.getElementById("reveal-image").style.opacity = "1";
    }

    function showIndustryQuiz() {
        const container = document.getElementById("jobQuiz");
        container.innerHTML = `<div class="question">In which industry do you currently work?</div>`;
        const options = ["Tech", "Media", "Law", "Market research", "Finance", "Other"];
        options.forEach((option, index) => {
            const div = document.createElement("div");
            div.classList.add("option");
            div.textContent = option;
            div.onclick = () => {
                selectedIndustry = index;
                showConcernedQuiz();
            };
            container.appendChild(div);
        });
    }

    function showConcernedQuiz() {
        const container = document.getElementById("jobQuiz");
        container.innerHTML = `<div class="question">How concerned are you about losing your job due to AI advancements like ChatGPT?</div>`;
        const options = ["Not concerned at all", "Slightly concerned", "Moderately concerned", "Very concerned", "Extremely concerned"];
        options.forEach((option, index) => {
            const div = document.createElement("div");
            div.classList.add("option");
            div.textContent = option;
            div.onclick = () => {
                selectedConcern = index;
                showStats();
            };
            container.appendChild(div);
        });
    }

    function showStats() {
        document.getElementById("jobQuiz").style.display = "none";
        const visualization = document.getElementById("jobQuizStats");
        visualization.style.display = "block";
        createStackedBarChart(jobData);
    }

    function createStackedBarChart(jobData) {

        // Normalize the data
        jobData.forEach(d => {
            const totalConcern = d.Concern_Level_Extremely + d.Concern_Level_Moderately + d.Concern_Level_Slightly + d.Concern_Level_Not_At_All;
            d.Concern_Level_Extremely = d.Jobs_At_Risk_Percentage * d.Concern_Level_Extremely / totalConcern;
            d.Concern_Level_Moderately = d.Jobs_At_Risk_Percentage * d.Concern_Level_Moderately / totalConcern;
            d.Concern_Level_Slightly = d.Jobs_At_Risk_Percentage * d.Concern_Level_Slightly / totalConcern;
            d.Concern_Level_Not_At_All = d.Jobs_At_Risk_Percentage * d.Concern_Level_Not_At_All / totalConcern;
        });

        const margin = { top: 20, right: 20, bottom: 20, left: 40 };
        const width = 600 - margin.left - margin.right;
        const height = 400 - margin.top - margin.bottom;

        const svg = d3.select("#jobQuizStats")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        const customColorScheme = [
            '#E9A987','#D3C3B9','#A7BFB3','#719B95',
        ];

        const x = d3.scaleBand().range([0, width]).padding(0.4);
        const y = d3.scaleLinear().range([height, 0]);
        const z = d3.scaleOrdinal(customColorScheme);


        const stack = d3.stack()
            .keys(["Concern_Level_Extremely", "Concern_Level_Moderately", "Concern_Level_Slightly", "Concern_Level_Not_At_All"]);
        x.domain(jobData.map(d => d.Industry));
        y.domain([0, 100]);
        z.domain(Array.from({ length: stack.keys().length }, (_, i) => i));

        const layer = svg.selectAll(".layer")
            .data(stack(jobData))
            .enter().append("g")
            .attr("class", "layer")
            .style("fill", (d, i) => z(i));

        layer.selectAll("rect")
            .data(d => d)
            .enter().append("rect")
            .attr("x", d => x(d.data.Industry))
            .attr("y", d => y(d[1]))
            .attr("height", d => y(d[0]) - y(d[1]))
            .attr("width", x.bandwidth());

        // Add x-axis
        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x))
            .selectAll("text")
            .style("font-size", "12px");


        // Add y-axis
        svg.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(y))
            .selectAll("text")
            .style("font-size", "12px");

        // Add legend
        const legend = svg.selectAll(".legend")
            .data(z.domain())
            .enter().append("g")
            .attr("class", "legend")
            .attr("transform", (d, i) => "translate(0," + i * 20 + ")");

        legend.append("rect")
            .attr("x", width - 18)
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", z);

        legend.append("text")
            .attr("x", width - 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .style("text-anchor", "end")
                .text((d, i) => {
                switch (i) {
                    case 0:
                        return "Extremely Concerned";
                    case 1:
                        return "Moderately Concerned";
                    case 2:
                        return "Slightly Concerned";
                    case 3:
                        return "Not At All Concerned";
                }
            });
    }

</script>
</body>
</html>